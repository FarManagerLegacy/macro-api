<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Взаимодействие с системой</title>
  <link rel="stylesheet" href="styles/tango.css">
  <link rel="stylesheet" href="styles/pandoc.css" />
  <link rel="stylesheet" href="styles/github.css" />
  <link rel="stylesheet" href="styles/dl_table.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="взаимодействие-с-системой">Взаимодействие с системой</h1>
<div class="functions">
<dl>
<dt><code>V=mf.clip(Cmd[,Value])</code></dt>
<dd><p>Позволяет производить разнообразные манипуляции с Clipboard в зависимости от заданного действия <code>Action</code>:</p>
<dl>
<dt><code>0</code></dt>
<dd>Возвращает данные из Clipboard; параметр <code>Value</code> игнорируется;
</dd>
<dt><code>1</code></dt>
<dd>Поместить строку <code>Value</code> в Clipboard;
</dd>
<dt><code>2</code></dt>
<dd>Добавить строку <code>Value</code> к Clipboard;
</dd>
<dt><code>3</code></dt>
<dd>Копировать Windows Clipboard во внутренний буфер обмена; параметр <code>Value</code> игнорируется;
</dd>
<dt><code>4</code></dt>
<dd>Копировать внутренний буфер обмена в Windows Clipboard; параметр <code>Value</code> игнорируется;
</dd>
<dt><code>5</code></dt>
<dd><p>Режимы работы с буфером обмена.</p>
<p>По умолчанию в операциях запоминания/вставки данных Far Manager работает с буфером обмена Windows.</p>
<p>Вызов <code>mf.clip(5)</code> позволяет в пределах одного макроса переключать внутренние механизмы Far Manager для работы с/без использования буфера обмена Windows.</p>
<p><code>Value</code> может быть одним из:</p>
<dl>
<dt><code>-1</code></dt>
<dd>Какой буфер обмена сейчас используется
</dd>
<dt><code>0</code></dt>
<dd>Переключить работу с буфера обмена OS на внутренний буфер и наоборот (работает как триггер).
</dd>
<dt><code>1</code></dt>
<dd>Включить буфер обмена OS
</dd>
<dt><code>2</code></dt>
<dd>Включить внутренний буфер обмена
</dd>
</dl>
<p>Функция возвращает предыдущее значение: <code>1</code> — буфер обмена OS, <code>2</code> — внутренний буфер.</p>
<p>Пример см. в разделе <a href="examples.html">Примеры</a>.</p>
</dd>
</dl>
<p>В случае ошибки возвращает <code>0</code></p>
<p>Например, поместить в Clipboard список отмеченных файлов в формате CSV (имя и размер):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource lua numberLines"><code class="sourceCode lua"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">local</span> <span class="cn">APANEL</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">local</span> <span class="cn">FILENAME</span><span class="op">,</span><span class="cn">ATTRIB</span><span class="op">,</span><span class="cn">SIZE</span><span class="op">,</span><span class="cn">SELECTED</span> <span class="op">=</span> <span class="dv">0</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">6</span><span class="op">,</span><span class="dv">8</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">local</span> <span class="cn">DIRECTORY</span> <span class="op">=</span> <span class="dv">0x00000010</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">local</span> <span class="kw">function</span> isFolder<span class="op">(</span>panel<span class="op">,</span>idx<span class="op">)</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="cf">return</span> band<span class="op">(</span><span class="cn">DIRECTORY</span><span class="op">,</span>Panel<span class="op">.</span>Item<span class="op">(</span>panel<span class="op">,</span>idx<span class="op">,</span><span class="cn">ATTRIB</span><span class="op">))==</span><span class="cn">DIRECTORY</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="cf">end</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw">local</span> <span class="cn">PUT</span><span class="op">,</span><span class="cn">ADD</span> <span class="op">=</span> <span class="dv">1</span><span class="op">,</span><span class="dv">2</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>Macro <span class="op">{</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>  description<span class="op">=</span><span class="st">&quot;поместить в Clipboard список отмеченных файлов в формате CSV (имя и размер)&quot;</span><span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>  area<span class="op">=</span><span class="st">&quot;Shell&quot;</span><span class="op">;</span> key<span class="op">=</span><span class="st">&quot;CtrlShiftIns&quot;</span><span class="op">;</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>  action<span class="op">=</span><span class="kw">function</span><span class="op">()</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>    mf<span class="op">.</span>clip<span class="op">(</span><span class="cn">PUT</span><span class="op">,</span><span class="st">&quot;Name;Size</span><span class="sc">\r\n</span><span class="st">&quot;</span><span class="op">)</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>    <span class="cf">for</span> i<span class="op">=</span><span class="dv">1</span><span class="op">,</span>APanel<span class="op">.</span>ItemCount <span class="cf">do</span></span>
<span id="cb1-14"><a href="#cb1-14"></a>      <span class="cf">if</span> <span class="kw">not</span> isFolder<span class="op">(</span><span class="cn">APANEL</span><span class="op">,</span>i<span class="op">)</span> <span class="kw">and</span> Panel<span class="op">.</span>Item<span class="op">(</span><span class="cn">APANEL</span><span class="op">,</span>i<span class="op">,</span><span class="cn">SELECTED</span><span class="op">)</span> <span class="cf">then</span></span>
<span id="cb1-15"><a href="#cb1-15"></a>        mf<span class="op">.</span>clip<span class="op">(</span><span class="cn">ADD</span><span class="op">,</span>Panel<span class="op">.</span>Item<span class="op">(</span><span class="cn">APANEL</span><span class="op">,</span>i<span class="op">,</span><span class="cn">FILENAME</span><span class="op">)..</span><span class="st">&quot;;&quot;</span><span class="op">..</span>Panel<span class="op">.</span>Item<span class="op">(</span><span class="cn">APANEL</span><span class="op">,</span>i<span class="op">,</span><span class="cn">SIZE</span><span class="op">)..</span><span class="st">&quot;</span><span class="sc">\r\n</span><span class="st">&quot;</span><span class="op">)</span></span>
<span id="cb1-16"><a href="#cb1-16"></a>      <span class="cf">end</span></span>
<span id="cb1-17"><a href="#cb1-17"></a>    <span class="cf">end</span></span>
<span id="cb1-18"><a href="#cb1-18"></a>  <span class="cf">end</span><span class="op">;</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="op">}</span></span></code></pre></div>
</dd>
<dt><code>S=mf.env(Name[,Mode[,Value]])</code></dt>
<dd><p>Позволяет работать с переменной среды <code>Name</code>. Если <code>Mode</code> не указан или равен <code>0</code>, то функция возвращает значение переменной среды (<code>Value</code> в этом случае игнорируется). Если <code>Mode</code> указан и отличен от <code>0</code>, то функция устанавливает значение или удаляет переменную среды.</p>
<p>Для варианта установки/удаления функция возвращает предыдущее значение (или пустую строку, если переменная была не определена).</p>
<p>Примеры.</p>
<div class="examples">
<dl>
<dt>Получить значение переменной среды <code>Foo</code></dt>
<dd><div class="sourceCode" id="cb2"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb2-1"><a href="#cb2-1"></a>mf<span class="op">.</span>env<span class="op">(</span><span class="st">&quot;Foo&quot;</span><span class="op">)</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>mf<span class="op">.</span>env<span class="op">(</span><span class="st">&quot;Foo&quot;</span><span class="op">,</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>mf<span class="op">.</span>env<span class="op">(</span><span class="st">&quot;Foo&quot;</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span>любое<span class="cn">_</span>значение<span class="op">)</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>mf<span class="op">.</span>env<span class="op">(</span><span class="st">&quot;Foo&quot;</span><span class="op">,</span><span class="kw">nil</span><span class="op">,</span>любое<span class="cn">_</span>значение<span class="op">)</span></span></code></pre></div>
</dd>
<dt>Установить значение переменной среды <code>Foo</code> в “<code>bar</code>”</dt>
<dd><code>mf.env("Foo",1,"Bar")</code>
</dd>
<dt>Удалить переменную среды <code>Foo</code></dt>
<dd><div class="sourceCode" id="cb3"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb3-1"><a href="#cb3-1"></a>mf<span class="op">.</span>env<span class="op">(</span><span class="st">&quot;Foo&quot;</span><span class="op">,</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>mf<span class="op">.</span>env<span class="op">(</span><span class="st">&quot;Foo&quot;</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="st">&quot;&quot;</span><span class="op">)</span></span></code></pre></div>
</dd>
<dt>Установить значение переменной среды <code>Foo</code> в “<code>0</code>”</dt>
<dd><div class="sourceCode" id="cb4"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb4-1"><a href="#cb4-1"></a>mf<span class="op">.</span>env<span class="op">(</span><span class="st">&quot;Foo&quot;</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="st">&quot;0&quot;</span><span class="op">)</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>mf<span class="op">.</span>env<span class="op">(</span><span class="st">&quot;Foo&quot;</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">)</span></span></code></pre></div>
</dd>
<dt>Если выбран английский язык интерфейса Far Manager, то что-то делаем</dt>
<dd><div class="sourceCode" id="cb5"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb5-1"><a href="#cb5-1"></a><span class="cf">if</span> mf<span class="op">.</span>env<span class="op">(</span><span class="st">&quot;FARLANG&quot;</span><span class="op">)==</span><span class="st">&quot;English&quot;</span> <span class="cf">then</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="co">-- что-то делаем</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="cf">end</span></span></code></pre></div>
</dd>
</dl>
</div>
</dd>
<dt><code>V=mf.flock(Lkey,Action)</code></dt>
<dd><p>Позволяет управлять состоянием Lock-клавиш (<span class="nowrap"><kbd>NumLock</kbd></span>, <span class="nowrap"><kbd>CapsLock</kbd></span> и <span class="nowrap"><kbd>ScrollLock</kbd></span>).</p>
<p>Клавиша <code>Lkey</code>:</p>
<dl>
<dt><code>0</code></dt>
<dd><span class="nowrap"><kbd>NumLock</kbd></span>
</dd>
<dt><code>1</code></dt>
<dd><span class="nowrap"><kbd>CapsLock</kbd></span>
</dd>
<dt><code>2</code></dt>
<dd><span class="nowrap"><kbd>ScrollLock</kbd></span>
</dd>
</dl>
<p>Действие <code>Action</code>:</p>
<dl>
<dt><code>-1</code></dt>
<dd>получить состояние клавиши
</dd>
<dt><code>0</code></dt>
<dd>погасить индикатор
</dd>
<dt><code>1</code></dt>
<dd>включить индикатор
</dd>
<dt><code>2</code></dt>
<dd>переключить индикатор в противоположное состояние
</dd>
</dl>
<p>Функция в младшем бите возвращает предыдущее значение режима выбранной клавиши (или текущее, если <code>Action=-1</code>).</p>
<p>Старший бит будет установлен, если в момент вызова функции клавиша удерживается.</p>
<p>Примечание:</p>
<p>Особенности текущей реализации: чтобы изменить состояние режима в момент удержания клавиши может понадобиться повторный вызов функции.</p>
<p>Поэтому, например, макрос, назначенный на <span class="nowrap"><kbd>Ctrl</kbd>+<kbd>CapsLock</kbd></span> может быть таким:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource lua numberLines"><code class="sourceCode lua"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">local</span> Caps<span class="op">,</span>toggle <span class="op">=</span> <span class="dv">1</span><span class="op">,</span><span class="dv">2</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>Macro <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>  description<span class="op">=</span><span class="st">&quot;переключение между окнами&quot;</span><span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  area<span class="op">=</span><span class="st">&quot;Shell Info QView Tree Editor Viewer&quot;</span><span class="op">;</span> key<span class="op">=</span><span class="st">&quot;CtrlCapsLock&quot;</span><span class="op">;</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>  action<span class="op">=</span><span class="kw">function</span><span class="op">()</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>    Keys<span class="op">(</span><span class="st">&quot;CtrlShiftTab&quot;</span><span class="op">)</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>    <span class="kw">local</span> mode <span class="op">=</span> band<span class="op">(</span>mf<span class="op">.</span>flock<span class="op">(</span>Caps<span class="op">,</span>toggle<span class="op">),</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>    mf<span class="op">.</span>flock<span class="op">(</span>Caps<span class="op">,</span><span class="dv">1</span><span class="op">-</span>mode<span class="op">)</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>  <span class="cf">end</span><span class="op">;</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="op">}</span></span></code></pre></div>
</dd>
<dt><code>N=Far.KbdLayout ([V])</code></dt>
<dd><p>Управление раскладкой клавиатуры.</p>
<p>Параметр <code>V</code>:</p>
<dl>
<dt><code>0</code></dt>
<dd>Вернуть текущее значение раскладки
</dd>
<dt><code>1</code></dt>
<dd>Переключиться на следующую раскладку (по кругу)
</dd>
<dt><code>-1</code></dt>
<dd>Переключиться на предыдущую раскладку (по кругу)
</dd>
<dt>Прочие значения</dt>
<dd><p>Переключиться в конкретную раскладку (например, <code>0x0409</code> или <code>0x4090409</code> — английская, <code>0x0419</code> или <code>0x04190419</code> — русская)</p>
<p>В случае указания несуществующей раскладки функция ошибку не выдаст и просто вернёт текущую раскладку.</p>
</dd>
</dl>
<p>Функция возвращает предыдущее значение раскладки или <code>0</code> в случае ошибки (не удалось определить имя текущей раскладки для консоли или не удалось получить описатель консольного окна).</p>
<p>Например (в командной строке):</p>
<div class="examples">
<dl>
<dt><code>lua:=mf.itoa(Far.KbdLayout(0x421),16)</code></dt>
<dd>при текущей русской раскладке просто вернёт <code>4190419</code>
</dd>
<dt><code>lua:=mf.itoa(Far.KbdLayout(),16)</code></dt>
<dd>при текущей русской раскладке вернёт <code>4190419</code>
</dd>
<dt><code>lua:=mf.itoa(Far.KbdLayout(0x409),16)</code></dt>
<dd>при текущей русской раскладке вернёт <code>4190419</code> и переключит рaскладку на английскую
</dd>
<dt><code>lua:=mf.itoa(Far.KbdLayout(1),16)</code></dt>
<dd>при текущей русской раскладке вернёт <code>4190419</code> и переключит на следующую рaскладку (по кругу)
</dd>
</dl>
</div>
</dd>
<dt><code>N=Far.Window_Scroll(Lines[,Axis])</code></dt>
<dd><p>Функция позволяет перемещать консольное окно по буферу.</p>
<p><code>Lines</code> — количество позиций для прокрутки: положительное число — вперёд (вниз/вправо), отрицательное — назад (вверх/влево).</p>
<p><code>Axis</code> — направление прокрутки (необязательный параметр): <code>0</code> — вертикаль (по умолчанию), <code>1</code> — горизонталь.</p>
<p>Функция возвращает <code>false</code>, если перемотка не состоялась (например, <code>Lines</code> был равен <code>0</code>), иначе <code>true</code>.</p>
</dd>
</dl>
</div>
</body>
</html>
